{% extends 'base.html' %}

{% block content %}
    <div class="dashboard">
        <h2>Welcome, {{ user.username }}</h2>
        <h1>My Dashboard</h1>

        <div class="dashboard-sections">
            <div class="section">
                <h3>Today's Tasks</h3>
                <div class="habit-container">                   
                    {% if daily_habits %}
                        <ul class="habit-list">
                            {% for habit in daily_habits %}
                                <li class="habit-item {% if habit.is_completed_today %}completed{% else %}not-completed{% endif %}">
                                    {% if not habit.is_completed_today %}
                                        <div class="habit-details">
                                            <strong class="habit-name">{{ habit.name }}</strong>
                                            <span class="habit-frequency">({{ habit.get_frequency_display }})</span>
                                        </div>
                                        <form action="{% url 'complete_habit' habit.id %}" method="POST" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="small-btn">Complete!</button>
                                        </form>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No tasks for today.</p>
                    {% endif %}
                    
                    <h4>This Week</h4>
                    {% if weekly_habits %}
                        <ul class="habit-list">
                            {% for habit in weekly_habits %}
                                <li class="habit-item {% if habit.is_completed_this_week %}completed{% else %}not-completed{% endif %}">

                                    {% if not habit.is_completed_this_week %}
                                        <div class="habit-details">
                                            <strong class="habit-name">{{ habit.name }}</strong>
                                            <span class="habit-frequency">({{ habit.get_frequency_display }})</span>
                                        </div>
                                        <form action="{% url 'complete_habit' habit.id %}" method="POST" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="small-btn">Complete!</button>
                                        </form>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No weekly tasks.</p>
                    {% endif %}
                    
                    {% if not daily_habits and not weekly_habits %}
                        <p>Looks like you're all caught up! Take this time to rest and recharge.</p>
                    {% endif %}
                </div>
            </div>

            <div class="section">
                <h3>Progress Summary</h3>
                <div class="progress-summary">
                </div>
            </div>

            <div class="section">
                <h3>Quick Statistics</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <span class="stat-number">{{ habit_count }}</span>
                        <span class="stat-label">Total Habits</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">{{ total_completions }}</span>
                        <span class="stat-label">Total Completions</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Motivation for Today</h3>
                    <div class="tip">
                        <p>{{ random_tip }}</p>
                    </div>
            </div>
        </div>
    </div>
{% endblock %}