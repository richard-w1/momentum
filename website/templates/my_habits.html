{% extends 'base.html' %}

{% block content %}
    <div class="habit-container">
        <h2>My Habits</h2>
        <div>
            <a href="{% url 'add_habit' %}" class="btn">Add a New Habit</a>
        </div>
        {% if habits %}
            <ul class="habit-list">
            {% for habit in habits %}
                <li class="habit-item">
                    <table class="habit-table">
                        <tr>
                            <td class="habit-details-name">{{ habit.name }}</td>
                            <td class="habit-details-labels">Current Streak</td>
                            <td class="habit-details-labels">Max Streak</td>
                            <td class="habit-details-labels">Missed</td>
                            <td class="habit-details-labels">Rate</td>
                            <td class="habit-details-labels">
                                    {% if habit.frequency == 'daily' and not habit.is_completed_today %}
                                        <form action="{% url 'complete_habit' habit.id %}" method="POST" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="small-btn done-btn">Done!</button>
                                        </form>
                                    {% elif habit.frequency == 'weekly' and not habit.is_completed_this_week %}
                                        <form action="{% url 'complete_habit' habit.id %}" method="POST" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="small-btn done-btn">Done!</button>
                                        </form>
                                    {% elif habit.frequency == 'monthly' and not habit.is_completed_this_month %}
                                        <form action="{% url 'complete_habit' habit.id %}" method="POST" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="small-btn done-btn">Done!</button>
                                        </form>
                                    {% endif %}
                            </td>
                            <td><a href="{% url 'edit_habit' habit.id %}" class="small-btn edit-btn">Edit</a></td>
                            <td><a href="{% url 'delete_habit' habit.id %}" class="small-btn delete-btn">Delete</a></td>

                        </tr>
                        
                        <tr>
                            <td class="habit-data">{{ habit.get_frequency_display }}</td>
                            <td class="habit-data">{{ habit.get_current_streak }}</td>
                            <td class="habit-data">{{ habit.get_max_streak }}</td>
                            <td class="habit-data">{{ habit.get_missed_occurrences }}</td>
                            <td class="habit-data">{{ habit.get_completion_rate|floatformat:2 }}%</td>
                        </tr>
                    </table>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>You don't have any habits yet. Start adding some!</p>
        {% endif %}
    </div>
{% endblock %}